# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `bcrypt` —Å 10 —Ä–∞—É–Ω–¥–∞–º–∏ (saltRounds)
- ‚úÖ –ü–∞—Ä–æ–ª–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (`bcrypt.hash`)

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `class-validator` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ DTO
- ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω—ã–π `ValidationPipe` —Å –æ–ø—Ü–∏—è–º–∏:
  - `whitelist: true` - —É–¥–∞–ª—è–µ—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –ø–æ–ª—è
  - `forbidNonWhitelisted: true` - –∑–∞–ø—Ä–µ—â–∞–µ—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –ø–æ–ª—è
  - `transform: true` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è email (—Ñ–æ—Ä–º–∞—Ç)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è username (3-50 —Å–∏–º–≤–æ–ª–æ–≤, —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã/—Ü–∏—Ñ—Ä—ã/–ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤, –º–∞–∫—Å–∏–º—É–º 100)

### 3. JWT —Ç–æ–∫–µ–Ω—ã
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `@nestjs/jwt` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –±–µ—Ä–µ—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –¢–æ–∫–µ–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ (sub, email)
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 7 –¥–Ω–µ–π)

### 4. –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è email –ø–µ—Ä–µ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è username –ø–µ—Ä–µ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π
- ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –ø–æ–Ω—è—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫ (ConflictException)

### 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ `UnauthorizedException` –¥–ª—è –Ω–µ–≤–µ—Ä–Ω—ã—Ö credentials
- ‚úÖ `ConflictException` –¥–ª—è –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö (–Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î)

### 6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ –ü–∞—Ä–æ–ª—å –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ—Ç–≤–µ—Ç–∞—Ö API
- ‚úÖ –ü—Ä–∏ –ª–æ–≥–∏–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ö–µ—à, –∞ –Ω–µ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–π —Ç–µ–∫—Å—Ç
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `bcrypt.compare` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

### 7. JWT Strategy
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `Authorization: Bearer <token>`

### 8. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –ù–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (passwordHash)
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (id, email, username)

## üîí –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è production

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```env
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)
JWT_SECRET="your-very-strong-secret-key-min-32-chars"

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞
JWT_EXPIRES_IN="1h"  # –∏–ª–∏ "15m" –¥–ª—è –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã (–Ω–µ –≤ MVP)
- [ ] Rate limiting –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç brute force
- [ ] Refresh tokens –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è access tokens
- [ ] Email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
- [ ] 2FA (–¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
- [ ] –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ –ø–æ—Å–ª–µ N –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- [ ] HTTPS —Ç–æ–ª—å–∫–æ (–≤ production)
- [ ] CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
auth/
‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îú‚îÄ‚îÄ register.dto.ts        # DTO –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ login.dto.ts           # DTO –¥–ª—è –ª–æ–≥–∏–Ω–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ auth-response.dto.ts   # DTO –¥–ª—è –æ—Ç–≤–µ—Ç–∞ (—Ç–æ–∫–µ–Ω + –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
‚îú‚îÄ‚îÄ strategies/
‚îÇ   ‚îî‚îÄ‚îÄ jwt.strategy.ts        # Passport JWT —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
‚îú‚îÄ‚îÄ guards/
‚îÇ   ‚îî‚îÄ‚îÄ jwt-auth.guard.ts      # Guard –¥–ª—è –∑–∞—â–∏—Ç—ã endpoints
‚îú‚îÄ‚îÄ decorators/
‚îÇ   ‚îî‚îÄ‚îÄ current-user.decorator.ts  # –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ auth.controller.ts         # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä (POST /auth/register, POST /auth/login)
‚îú‚îÄ‚îÄ auth.service.ts           # –°–µ—Ä–≤–∏—Å (–ª–æ–≥–∏–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–ª–æ–≥–∏–Ω–∞)
‚îî‚îÄ‚îÄ auth.module.ts            # –ú–æ–¥—É–ª—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π JWT
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
```bash
POST /auth/register
{
  "email": "test@example.com",
  "username": "testuser",
  "password": "password123"
}
```
–û–∂–∏–¥–∞–µ—Ç—Å—è: 201 Created —Å —Ç–æ–∫–µ–Ω–æ–º –∏ –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –¢–µ—Å—Ç 2: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º email
```bash
POST /auth/register
{
  "email": "test@example.com",  # —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  "username": "newuser",
  "password": "password123"
}
```
–û–∂–∏–¥–∞–µ—Ç—Å—è: 409 Conflict

### –¢–µ—Å—Ç 3: –õ–æ–≥–∏–Ω —Å –Ω–µ–≤–µ—Ä–Ω—ã–º–∏ credentials
```bash
POST /auth/login
{
  "email": "test@example.com",
  "password": "wrongpassword"
}
```
–û–∂–∏–¥–∞–µ—Ç—Å—è: 401 Unauthorized

### –¢–µ—Å—Ç 4: –õ–æ–≥–∏–Ω —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ credentials
```bash
POST /auth/login
{
  "email": "test@example.com",
  "password": "password123"
}
```
–û–∂–∏–¥–∞–µ—Ç—Å—è: 200 OK —Å —Ç–æ–∫–µ–Ω–æ–º

### –¢–µ—Å—Ç 5: –í–∞–ª–∏–¥–∞—Ü–∏—è - –Ω–µ–≤–µ—Ä–Ω—ã–π email —Ñ–æ—Ä–º–∞—Ç
```bash
POST /auth/register
{
  "email": "not-an-email",
  "username": "testuser",
  "password": "password123"
}
```
–û–∂–∏–¥–∞–µ—Ç—Å—è: 400 Bad Request —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –æ—à–∏–±–∫–∏

### –¢–µ—Å—Ç 6: –í–∞–ª–∏–¥–∞—Ü–∏—è - –∫–æ—Ä–æ—Ç–∫–∏–π –ø–∞—Ä–æ–ª—å
```bash
POST /auth/register
{
  "email": "test@example.com",
  "username": "testuser",
  "password": "123"  # –º–µ–Ω—å—à–µ 6 —Å–∏–º–≤–æ–ª–æ–≤
}
```
–û–∂–∏–¥–∞–µ—Ç—Å—è: 400 Bad Request

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

- ‚úÖ –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è —Å bcrypt
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞ —á–∏—Å—Ç–∞—è –∏ –º–æ–¥—É–ª—å–Ω–∞—è
- ‚úÖ –ù–µ—Ç –ª–∏—à–Ω–µ–≥–æ –∫–æ–¥–∞
- ‚úÖ –°–ª–µ–¥—É–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ NestJS
