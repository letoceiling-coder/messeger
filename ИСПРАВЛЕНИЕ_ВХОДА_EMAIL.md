# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –í–•–û–î–ê - CASE-INSENSITIVE EMAIL

## üîç –ü–†–û–ë–õ–ï–ú–ê:

–û—à–∏–±–∫–∞ 401 Unauthorized –ø—Ä–∏ –≤—Ö–æ–¥–µ:
- Email –≤ –±–∞–∑–µ: `dsc-23@yandex.RU` (–∑–∞–≥–ª–∞–≤–Ω—ã–µ)
- Email –ø—Ä–∏ –≤—Ö–æ–¥–µ: `dsc-23@yandex.RU` –∏–ª–∏ `dsc-23@yandex.ru`
- MySQL –º–æ–∂–µ—Ç –±—ã—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ —Ä–µ–≥–∏—Å—Ç—Ä—É –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï:

–û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `login` –≤ `backend/src/auth/auth.service.ts`:

1. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è email** - –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
2. **–î–≤–æ–π–Ω–æ–π –ø–æ–∏—Å–∫** - —Å–Ω–∞—á–∞–ª–∞ –ø–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É email, –∑–∞—Ç–µ–º –ø–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É
3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ —Å—Å—ã–ª–∫–∏** –Ω–∞ `user` ‚Üí `foundUser`

**–ö–æ–¥:**
```typescript
async login(dto: LoginDto): Promise<AuthResponseDto> {
  // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email (case-insensitive —á–µ—Ä–µ–∑ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é)
  const emailLower = dto.email.toLowerCase().trim();
  const user = await this.prisma.user.findFirst({
    where: {
      email: {
        equals: emailLower,
      },
    },
  });

  // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω —Å lowercase, –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É email
  const foundUser = user || await this.prisma.user.findUnique({
    where: { email: dto.email.trim() },
  });

  if (!foundUser) {
    throw new UnauthorizedException('–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
  const isPasswordValid = await bcrypt.compare(dto.password, foundUser.passwordHash);
  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
}
```

---

## üéâ –ì–û–¢–û–í–û!

–¢–µ–ø–µ—Ä—å –≤—Ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞ email:
- `dsc-23@yandex.RU` ‚úÖ
- `dsc-23@yandex.ru` ‚úÖ
- `DSC-23@YANDEX.RU` ‚úÖ

---

## üìù –ü–†–ò–ú–ï–ß–ê–ù–ò–ï:

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
1. –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ email –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤ –Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä
2. –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å email –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

–ù–æ —Ç–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Ö–æ–¥–∞.
