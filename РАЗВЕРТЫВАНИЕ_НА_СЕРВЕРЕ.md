# –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï –ü–†–û–ï–ö–¢–ê –ù–ê –°–ï–†–í–ï–†–ï

## üöÄ –ü–û–®–ê–ì–û–í–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Backend

```bash
ssh dsc23ytp@5.101.156.207
cd ~/messager/backend

# 1. –°–æ–∑–¥–∞—Ç—å .env.production
nano .env.production
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å:
# DATABASE_URL=postgresql://user:password@localhost:5432/messager
# JWT_SECRET=your-secret-key-here
# REDIS_URL=redis://localhost:6379
# PORT=3000
# NODE_ENV=production
# CORS_ORIGIN=https://parser-auto.siteaccess.ru

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install --production

# 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma Client
npx prisma generate

# 4. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î
npx prisma migrate deploy

# 5. –°–±–æ—Ä–∫–∞
npm run build

# 6. –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
mkdir -p uploads/audio logs

# 7. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PM2 (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
npm install -g pm2

# 8. –ó–∞–ø—É—Å—Ç–∏—Ç—å
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

---

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Frontend

```bash
cd ~/messager/frontend-web

# 1. –°–æ–∑–¥–∞—Ç—å .env.production
nano .env.production
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å:
# VITE_API_URL=https://parser-auto.siteaccess.ru/api
# VITE_WS_URL=wss://parser-auto.siteaccess.ru

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# 3. –°–±–æ—Ä–∫–∞
npm run build

# 4. –†–∞–∑–º–µ—Å—Ç–∏—Ç—å build –≤ public_html
cp -r dist/* ~/parser-auto.site-access.ru/public_html/
```

---

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

```bash
sudo nano /etc/nginx/sites-available/parser-auto
```

–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (—Å–º. –Ω–∏–∂–µ)

```bash
sudo ln -s /etc/nginx/sites-available/parser-auto /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

---

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# Backend
curl http://localhost:3000/health

# PM2 —Å—Ç–∞—Ç—É—Å
pm2 status
pm2 logs messager-backend

# Frontend
# –û—Ç–∫—Ä–æ–π—Ç–µ: https://parser-auto.siteaccess.ru/
```

---

## üìã NGINX –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

```nginx
server {
    listen 80;
    server_name parser-auto.siteaccess.ru;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name parser-auto.siteaccess.ru;

    root /home/dsc23ytp/parser-auto.site-access.ru/public_html;
    index index.html;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    # Frontend
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Backend API
    location /api {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # WebSocket
    location /socket.io/ {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
    }
}
```
