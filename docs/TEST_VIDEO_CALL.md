# Тестирование видеозвонка (с TURN)

## Что уже запущено

- **coturn** — TURN-сервер на `89.169.39.244:3478`, сервис `active`, порт слушается.
- **Backend** — PM2 `messager-backend` online, API отвечает (например `/api/health` → 200).
- **Frontend** — собран с `.env.production` (VITE_TURN_*), в бандле есть TURN.
- **Nginx** — конфиг ок, раздаёт фронт и проксирует API/WebSocket.

## Как протестировать видеозвонок

### 1. Два устройства

- **ПК** — браузер: https://neekloai.ru или http://89.169.39.244  
- **Телефон** — тот же URL (желательно мобильный интернет, не тот же Wi‑Fi, чтобы проверить TURN).

### 2. Два пользователя

- Зайдите под разными аккаунтами (или один на ПК, второй на телефоне).

### 3. Создать чат и позвонить

- С одного устройства откройте чат со вторым пользователем.
- Нажмите кнопку **видеозвонка** (или голосовой звонок).
- На втором устройстве примите звонок.
- Должны появиться изображение/звук; при использовании TURN в логах может быть тип кандидата `relay`.

### 4. Проверить логи звонка

- В интерфейсе звонка нажмите **«Логи»** (если есть).
- Убедитесь, что `iceConnectionState` доходит до `connected`.
- При работе через TURN в логах ICE может быть виден кандидат с типом `relay`.

### 5. Если звонок не устанавливается

- Убедитесь, что на хосте/VPS открыты порты **3478** (UDP/TCP) и **49152–65535** (UDP) — в панели хостинга, если ufw выключен.
- На сервере: `systemctl status coturn`, `ss -ulnp | grep 3478`.
- Проверьте, что фронт пересобран после создания `.env.production` (в бандле должен быть IP TURN).

## Быстрая проверка сервисов на сервере

```bash
ssh root@89.169.39.244

# coturn
systemctl is-active coturn
ss -ulnp | grep 3478

# backend
pm2 list
curl -s -o /dev/null -w '%{http_code}' http://localhost:30000/api/health

# фронт с TURN
grep -l 89.169.39.244 /var/www/messager/frontend-web/dist/assets/*.js
```

Все команды должны вернуть ожидаемый результат (active, порт, 200, путь к JS).
