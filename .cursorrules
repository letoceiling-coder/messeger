# Правила проекта Messager

## Запрос «выполни деплой»

**Правило:** Если пользователь просит выполнить деплой — значит обновить код на сервере: синхронизировать/подтянуть код, собрать фронт и бэк, перезапустить приложение (PM2), при необходимости перезагрузить Nginx. Выполнять деплой по запросу (например, запуск `.\scripts\deploy-update.ps1` или инструкция выполнить на сервере `pull-and-update.sh`).

## Деплой при изменениях кода (ОБЯЗАТЕЛЬНО, БЕЗ ИСКЛЮЧЕНИЙ)

**Правило:** При любом изменении кода — полное обновление на сервере (код + сборка + перезапуск).

### Рекомендуемый способ: через Git

Репозиторий: **https://github.com/letoceiling-coder/messeger.git**

1. **Локально:** закоммитить и отправить в Git:
   ```bash
   git add .
   git commit -m "описание"
   git push
   ```
2. **На сервере:** подтянуть код и обновиться:
   ```bash
   cd /var/www/messager && bash scripts/pull-and-update.sh
   ```
   Скрипт делает: `git pull`, сборку фронта и бэка, перезапуск PM2, перезагрузку Nginx.

Подробно: см. **DEPLOY_GIT.md**.

### Быстрый деплой через Git (рекомендуется для скорости)

Один скрипт с ПК: push + одна SSH-команда на сервере (без rsync/scp — только дельты кода):
```powershell
.\scripts\deploy-git.ps1
```
Требует: локально закоммиченные изменения, настроенный `git push` и SSH до сервера. Сервер должен быть настроен на `pull-and-update.sh` (Git-репозиторий в `/var/www/messager`).

### Альтернатива: синхронизация с ПК (rsync/scp)

Если не используете Git на сервере:
```powershell
.\scripts\deploy-update.ps1
```
Копирует файлы на сервер (rsync/scp) и запускает обновление по SSH. Медленнее, чем deploy-git.ps1.

Сервер: `root@89.169.39.244`, путь: `/var/www/messager`.
