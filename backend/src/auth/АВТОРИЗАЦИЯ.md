# Авторизация — как устроено

## Проверка: вход работает

Логин **dsc-23@yandex.ru** / **123123123** — успешный вход, открывается страница «Чаты».

---

## Регистрация (сохранение пароля)

**Файл:** `backend/src/auth/auth.service.ts`, метод `register`.

1. Приходит пароль в открытом виде: `dto.password`.
2. Хешируем: `bcrypt.hash(dto.password, 10)` — получаем строку-хеш.
3. В БД сохраняем только хеш в поле `passwordHash`. Сам пароль нигде не хранится.

**Итог:** пароль при регистрации записывается правильно (bcrypt, 10 раундов).

---

## Вход (проверка пароля)

**Файл:** `backend/src/auth/auth.service.ts`, метод `login`.

1. Находим пользователя по email, достаём из БД его `passwordHash`.
2. Сравниваем: `bcrypt.compare(dto.password, foundUser.passwordHash)`.
   - Если совпало — возвращаем токен и данные пользователя.
   - Если нет — 401 «Неверный email или пароль».

**Итог:** при авторизации пароль проверяется правильно (bcrypt.compare).

---

## Одна цепочка

- **Регистрация:** пароль → `bcrypt.hash()` → сохраняем хеш в БД.
- **Вход:** введённый пароль + хеш из БД → `bcrypt.compare()` → ок/ошибка.

Дополнительной логики нет, всё в `auth.service.ts`. Если раньше не заходило — причина была в том, что в БД лежал хеш от другого пароля (его поправили скриптом `scripts/update-password.js`).
