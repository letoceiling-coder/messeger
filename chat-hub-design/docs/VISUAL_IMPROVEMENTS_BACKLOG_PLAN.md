# План реализации недостающих визуальных улучшений

План для пунктов из отчёта «частично» и «не реализовано». Порядок: по приоритету и зависимостям (сначала общие ресурсы, потом экраны).

---

## Приоритет 1 — Общие ресурсы и компоненты

### 1.1 CSS-переменные из плана

**Цель:** добавить переменные для единообразия градиентов и анимаций.

| Переменная | Значение (пример) | Где использовать |
|------------|-------------------|------------------|
| `--gradient-telegram` | `linear-gradient(135deg, hsl(var(--primary)) 0%, hsl(199 100% 55%) 100%)` | Header списка чатов, кнопки |
| `--gradient-channel` | `linear-gradient(135deg, #667eea 0%, #764ba2 100%)` | Header чата-канала |
| `--gradient-story` | `linear-gradient(135deg, #f093fb 0%, #f5576c 50%, #fda085 100%)` | Рамки stories (непросмотренные) |
| `--transition-fast` | `150ms cubic-bezier(0.4, 0, 0.2, 1)` | Кнопки, переключатели |
| `--transition-spring` | `300ms cubic-bezier(0.34, 1.56, 0.64, 1)` | Модалки, карточки |

**Файлы:** `src/index.css` (в `:root` и при необходимости в `.dark`).

**Шаги:**
1. В `:root` добавить перечисленные переменные.
2. В `.dark` при необходимости задать варианты для тёмной темы (например, чуть приглушённые градиенты).
3. По желанию заменить жёстко заданные градиенты в компонентах на `var(--gradient-*)`.

---

### 1.2 Компонент TypingIndicator

**Цель:** вынести «печатает» + анимированные точки в переиспользуемый компонент.

**Файлы:**
- Создать: `src/components/common/TypingIndicator.tsx`
- Изменить: `src/components/chats/ChatListItem.tsx` — заменить inline-разметку на `<TypingIndicator />`

**Шаги:**
1. Создать компонент с пропами, например: `className?: string`, опционально `size?: 'sm' | 'md'`.
2. Внутри: текст «печатает» + три точки с `animate-bounce` и задержками 0 / 150ms / 300ms.
3. В `ChatListItem` импортировать и рендерить при `chat.isTyping`.
4. При необходимости использовать в `ChatPage` в header (статус под именем).

---

### 1.3 Компонент OnlinePulse

**Цель:** переиспользуемый индикатор «онлайн» с пульсацией.

**Файлы:**
- Создать: `src/components/common/OnlinePulse.tsx`
- Изменить: `src/components/chats/ChatListHeader.tsx`, `src/components/chats/ChatListItem.tsx` — заменить inline-разметку на `<OnlinePulse />`

**Шаги:**
1. Компонент: зелёный кружок + внутренний элемент с `animate-ping`, опционально `size`, `className`.
2. Подставить в header списка чатов и в карточку чата (рядом с аватаром, когда `isOnline`).

---

## Приоритет 2 — Экран чата (ChatPage)

### 2.1 Header чата для канала

**Цель:** для каналов — градиентный header, иконка мегафона, счётчик подписчиков.

**Файлы:** `src/pages/ChatPage.tsx`, при необходимости `src/context/ChatsContext.tsx` или мок-данные.

**Шаги:**
1. В контексте или типе чата убедиться, что есть поле подписчиков (например, `subscribersCount?: number`); если нет — добавить в тип и моки.
2. В `ChatPage` в блоке `<header>`:
   - Условие: если `chat?.isChannel` — применять класс/стиль с `var(--gradient-channel)` или готовым градиентом (фиолетовый).
   - Слева от имени: иконка `Megaphone` (lucide-react).
   - Под именем или рядом: текст вида «N подписчиков» (если есть `subscribersCount`).
3. Сохранить текущий вид для обычных чатов и ботов.

---

### 2.2 Пульсирующий онлайн-индикатор в header чата

**Цель:** в header экрана чата показывать зелёный пульсирующий кружок при онлайн (для пользовательских чатов).

**Файлы:** `src/pages/ChatPage.tsx`, `src/components/common/OnlinePulse.tsx` (после 1.3).

**Шаги:**
1. Рядом с аватаром в header чата (для не-бота и не-канала) рендерить `<OnlinePulse />` только если `chat.isOnline`.
2. Размер подобрать под текущий header (например, маленький кружок у аватара).

---

### 2.3 Анимация появления пузырей сообщений

**Цель:** при появлении нового сообщения — лёгкая анимация (например, slide + fade).

**Файлы:** `src/pages/ChatPage.tsx`.

**Шаги:**
1. Оборачивать каждый пузырь (или группу по дате) в `motion.div` с `initial={{ opacity: 0, y: 8 }}`, `animate={{ opacity: 1, y: 0 }}`, опционально `transition: { type: 'spring', ... }`.
2. Использовать стабильный `key` (например, `message.id`), чтобы анимация не повторялась при скролле/ре-рендере.
3. При необходимости ограничить анимацию только последними N сообщениями или только при добавлении нового (через флаг «только что добавлено»).

---

### 2.4 Зона ввода: плавающий стиль и анимация Send/Mic

**Цель:** визуально «плавающая» панель ввода и плавная смена иконки Send ↔ Mic.

**Файлы:** `src/pages/ChatPage.tsx`, при необходимости `src/index.css`.

**Шаги:**
1. Контейнер панели ввода: скругление (например, `rounded-2xl`), тень (`shadow-soft` или своя), отступ от краёв — создать эффект «карточки» над клавиатурой.
2. Кнопка Send / блок Mic+VideoNote: обернуть в `motion.div` с `AnimatePresence` и `mode="wait"`; при смене `inputValue.trim()` анимировать появление/исчезновение (scale + opacity) или crossfade.

---

### 2.5 Blur-эффект при загрузке медиа

**Цель:** пока изображение/видео грузится — показывать размытое плейсхолдер или низкое разрешение.

**Файлы:** компоненты, рендерящие медиа в сообщениях: `src/pages/ChatPage.tsx` (превью изображений/видео), при необходимости общий компонент превью.

**Шаги:**
1. Для `<img>`: до `onLoad` вешать класс `blur-sm` (или `blur-md`) и, по желанию, низкое разрешение/placeholder; после `onLoad` убирать blur.
2. Для `<video>`: аналогично по `onLoadedData` или показ первого кадра.
3. Опционально: маленький скелетон или плейсхолдер на время загрузки.

---

## Приоритет 3 — Боты и каналы

### 3.1 Боты: иконка для inline-кнопок и фоновый паттерн

**Цель:** иконка у inline-кнопок (callback); опционально — лёгкий фоновый паттерн в чате с ботом.

**Файлы:** `src/components/chat/BotButtons.tsx`, `src/pages/ChatPage.tsx` (или layout чата).

**Шаги:**
1. **BotButtons:** для `btn.type === 'inline'` добавить иконку (например, `Zap` или `MousePointerClick` из lucide-react) слева от `btn.label`.
2. **Фон чата с ботом:** в `ChatPage` при `chat?.isBot` задать контейнеру сообщений фоновый класс: например, очень светлый повторяющийся паттерн (CSS pattern или мелкая сетка) или градиент с низкой непрозрачностью.

---

### 3.2 BotKeyboard: плавное появление/скрытие

**Цель:** клавиатура бота появляется и скрывается с анимацией (height/opacity или slide).

**Файлы:** `src/components/chat/BotKeyboard.tsx`, `src/pages/ChatPage.tsx`.

**Шаги:**
1. В `ChatPage` обернуть рендер `BotKeyboard` в `AnimatePresence` и условный `motion.div` с `initial={{ opacity: 0, height: 0 }}`, `animate={{ opacity: 1, height: 'auto' }}`, `exit={{ opacity: 0, height: 0 }}` (или `translateY`).
2. Передавать стабильный `key`, чтобы анимация срабатывала при появлении/исчезновении клавиатуры.

---

### 3.3 Канал: анимация кнопки «Подписаться / Отписаться»

**Цель:** при смене статуса подписки — короткая анимация (например, scale или смена цвета).

**Файлы:** `src/pages/ChatPage.tsx` (блок с кнопкой подписки для канала).

**Шаги:**
1. Кнопку подписки обернуть в `motion.button` или `motion.div` с `whileTap={{ scale: 0.98 }}`.
2. При смене подписка → отписка (или наоборот) добавить `key={isSubscribed}` и лёгкую анимацию перехода (например, `animate={{ backgroundColor: ... }}` или смена иконки через `AnimatePresence`).

---

## Приоритет 4 — Лента (FeedPage)

### 4.1 Stories: серые рамки для просмотренных

**Цель:** у просмотренных историй — серая рамка вместо градиентной.

**Файлы:** `src/types/feed.ts` (или аналог), `src/pages/feed/FeedPage.tsx`, при необходимости контекст/моки.

**Шаги:**
1. В типе истории добавить поле `viewed?: boolean` (или `isViewed`). В моках или при открытии story помечать её как просмотренную (например, в контексте/состоянии).
2. В `FeedPage` при рендере кольца story: если `viewed` — классы `border-2 border-muted-foreground/50` (или серая рамка); иначе — текущий градиент `bg-gradient-to-tr from-yellow-400 ...`.

---

### 4.2 Stories: анимация нажатия на превью

**Цель:** при тапе на аватар story — лёгкая анимация (scale).

**Файлы:** `src/pages/feed/FeedPage.tsx`.

**Шаги:**
1. Кнопку (превью story) обернуть в `motion.button` с `whileTap={{ scale: 0.95 }}` (или аналогично).

---

### 4.3 Лайк: пульсация сердца и двойной тап

**Цель:** анимация «пульсации» при лайке; лайк по двойному тапу по посту.

**Файлы:** `src/pages/feed/FeedPage.tsx` (компонент `FeedPostItem`).

**Шаги:**
1. **Пульсация:** при вызове `onLike` показывать поверх контента большую иконку сердца с анимацией: `motion.div` с `initial={{ scale: 0 }}`, `animate={{ scale: 1.2 }}` и затем исчезновение (или один «удар» пульса через keyframes). Показывать 300–500 ms, затем скрывать.
2. **Двойной тап:** на контейнер медиа поста повесить `onDoubleClick` (или обработчик двойного тапа через touch), вызывающий `onLike()` и, при желании, ту же анимацию сердца.

---

## Приоритет 5 — Комментарии и настройки

### 5.1 Комментарии: вложенные ответы и анимация появления

**Цель:** явные отступы для вложенных ответов; анимация при добавлении нового комментария.

**Файлы:** `src/components/chat/CommentsSheet.tsx` (или экран комментариев поста), типы/моки при необходимости.

**Шаги:**
1. Если в данных есть `parentId` или уровень вложенности — рендерить ответ с отступом (например, `pl-4` или `ml-4`) и визуальной связью (вертикальная черта или отступ).
2. При добавлении нового комментария (если есть такой сценарий в UI) рендерить его в `motion.div` с `initial={{ opacity: 0, y: 8 }}`, `animate={{ opacity: 1, y: 0 }}`.

---

### 5.2 Настройки: анимированный переключатель темы

**Цель:** при смене темы в диалоге «Внешний вид» — лёгкая анимация выбора (например, галочка или подсветка).

**Файлы:** `src/pages/SettingsPage.tsx`.

**Шаги:**
1. Обернуть каждый `label` с `RadioGroupItem` в `motion.label` с `whileTap={{ scale: 0.98 }}`.
2. При смене значения добавить анимацию подсветки выбранного пункта (например, `layout` или анимированный border/background через Framer Motion).

---

## Приоритет 6 — Общий UX

### 6.1 Тёмная тема: subtle-градиенты

**Цель:** в тёмном режиме использовать чуть приглушённые или другие градиенты для header/карточек.

**Файлы:** `src/index.css` (секция `.dark`), при необходимости компоненты с градиентами.

**Шаги:**
1. В `.dark` задать, при необходимости, переопределения для градиентов (например, чуть более тёмные оттенки в `--gradient-telegram` / `--gradient-channel` или отдельные классы).
2. Проверить header списка чатов, настройки и экран чата-канала в тёмной теме.

---

### 6.2 Haptic feedback (вибрация)

**Цель:** короткая вибрация при нажатии на ключевые кнопки (отправка, лайк, важные действия).

**Файлы:** утилита или хук, затем кнопки в `ChatPage`, `FeedPage`, возможно `BotButtons` и др.

**Шаги:**
1. Создать хук `useHaptic.ts`: внутри проверять `navigator.vibrate`; при вызове `vibrate()` вызывать `navigator.vibrate(10)` (или [10, 5, 10] для двойного лёгкого удара). На десктопе ничего не делать.
2. В обработчиках отправки сообщения, лайка, нажатия на inline-кнопку вызывать этот хук.
3. Учесть, что на iOS Safari поддержка вибрации ограничена; при необходимости документировать или отключать на неподдерживаемых устройствах.

---

## Порядок выполнения (рекомендуемый)

1. **Фаза A — фундамент:** 1.1 (CSS), 1.2 (TypingIndicator), 1.3 (OnlinePulse).
2. **Фаза B — экран чата:** 2.1, 2.2, 2.3, 2.4, 2.5.
3. **Фаза C — боты и каналы:** 3.1, 3.2, 3.3.
4. **Фаза D — лента:** 4.1, 4.2, 4.3.
5. **Фаза E — комментарии и настройки:** 5.1, 5.2.
6. **Фаза F — полировка:** 6.1, 6.2.

Зависимости: 2.2 опирается на 1.3; 2.1 можно делать без 1.1, подставив градиент напрямую. Остальное можно выполнять параллельно после фазы A.

---

## Чек-лист по завершению

- [ ] 1.1 CSS-переменные
- [ ] 1.2 TypingIndicator
- [ ] 1.3 OnlinePulse
- [ ] 2.1 Header чата для канала
- [ ] 2.2 Онлайн-пульс в header чата
- [ ] 2.3 Анимация появления пузырей
- [ ] 2.4 Плавающая зона ввода и анимация Send/Mic
- [ ] 2.5 Blur при загрузке медиа
- [ ] 3.1 Боты: иконка inline, фон чата
- [ ] 3.2 BotKeyboard: появление/скрытие
- [ ] 3.3 Канал: анимация подписки
- [ ] 4.1 Stories: просмотренные (серые рамки)
- [ ] 4.2 Stories: анимация нажатия
- [ ] 4.3 Лайк: пульсация и двойной тап
- [ ] 5.1 Комментарии: вложенность и анимация
- [ ] 5.2 Настройки: анимация темы
- [ ] 6.1 Тёмная тема: градиенты
- [ ] 6.2 Haptic feedback
