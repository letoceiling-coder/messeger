# ‚úÖ –§–ò–ù–ê–õ–¨–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï EMAIL

## üîç –ü–†–û–ë–õ–ï–ú–ê:

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:** `dsc-23@yandex.ru` ‚Üí "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
2. **–í—Ö–æ–¥:** `dsc-23@yandex.RU` ‚Üí 401 Unauthorized

**–ü—Ä–∏—á–∏–Ω–∞:** Email –≤ –±–∞–∑–µ –±—ã–ª `dsc-23@yandex.RU` (uppercase), –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä.

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï:

### 1. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è email –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–í—ã–ø–æ–ª–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è:
```sql
UPDATE users SET email = LOWER(email);
```

–†–µ–∑—É–ª—å—Ç–∞—Ç: `dsc-23@yandex.RU` ‚Üí `dsc-23@yandex.ru`

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

- Email –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ lowercase –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–º

```typescript
async register(dto: RegisterDto): Promise<AuthResponseDto> {
  // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è email (case-insensitive - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ lowercase)
  const emailNormalized = dto.email.toLowerCase().trim();
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è email (–∏—â–µ–º –ø–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É –∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É)
  const existingUserByEmail = await this.prisma.user.findFirst({
    where: {
      OR: [
        { email: emailNormalized },
        { email: dto.email.trim() },
      ],
    },
  });

  // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (email —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ)
  const user = await this.prisma.user.create({
    data: {
      email: emailNormalized, // –í—Å–µ–≥–¥–∞ lowercase
      username: dto.username,
      passwordHash,
    },
  });
}
```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –≤—Ö–æ–¥

- Email –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º
- –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–º

```typescript
async login(dto: LoginDto): Promise<AuthResponseDto> {
  // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è email (case-insensitive)
  const emailNormalized = dto.email.toLowerCase().trim();
  
  // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email (–ø—Ä–æ–±—É–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π)
  const foundUser = await this.prisma.user.findFirst({
    where: {
      OR: [
        { email: emailNormalized },
        { email: dto.email.trim() },
      ],
    },
  });
}
```

---

## üéâ –ì–û–¢–û–í–û!

–¢–µ–ø–µ—Ä—å:
- ‚úÖ Email –≤ –±–∞–∑–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω: `dsc-23@yandex.ru`
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–º email
- ‚úÖ –í—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–º email
- ‚úÖ –í—Å–µ –Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å email –≤ lowercase

---

## üìù –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:

**–í—Ö–æ–¥:**
- Email: `dsc-23@yandex.ru` ‚úÖ
- Email: `dsc-23@yandex.RU` ‚úÖ
- Email: `DSC-23@YANDEX.RU` ‚úÖ
- Password: `123123123`

**–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:**
- –õ—é–±–æ–π —Ä–µ–≥–∏—Å—Ç—Ä email –±—É–¥–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω –≤ lowercase
- –î—É–±–ª–∏–∫–∞—Ç—ã –ø–æ email (—Å —Ä–∞–∑–Ω—ã–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–º) –Ω–µ –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è
