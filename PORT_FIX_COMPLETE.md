# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–†–¢–ê NGINX –ó–ê–í–ï–†–®–ï–ù–û (31.01.2026 16:57)

## üêõ –ü–†–û–ë–õ–ï–ú–ê –ù–ê–ô–î–ï–ù–ê:

### –û—à–∏–±–∫–∞ 502 Bad Gateway
```
GET https://neekloai.ru/api/chats/... 502 (Bad Gateway)
GET https://neekloai.ru/api/messages?... 502 (Bad Gateway)
WebSocket connection to 'wss://neekloai.ru/socket.io/...' failed
```

### –ü—Ä–∏—á–∏–Ω–∞:
**–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ—Ä—Ç–æ–≤:**
- Backend —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞: **3001** ‚úÖ
- Nginx –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–ª –Ω–∞: **30000** ‚ùå

```nginx
# –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
proxy_pass http://localhost:30000;

# –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
proxy_pass http://localhost:3001;
```

---

## ‚úÖ –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û:

### 1. –û–±–Ω–æ–≤–ª—ë–Ω nginx/messager-vps.conf
```nginx
# HTTP (89.169.39.244)
location /api {
    proxy_pass http://localhost:3001;  ‚Üê –ë—ã–ª–æ 30000
}
location /socket.io {
    proxy_pass http://localhost:3001;  ‚Üê –ë—ã–ª–æ 30000
}

# HTTPS (neekloai.ru)
location /api {
    proxy_pass http://localhost:3001;  ‚Üê –ë—ã–ª–æ 30000
}
location /socket.io {
    proxy_pass http://localhost:3001;  ‚Üê –ë—ã–ª–æ 30000
}
```

### 2. –î–µ–ø–ª–æ–π –≤—ã–ø–æ–ª–Ω–µ–Ω
```bash
git pull origin main
cp nginx/messager-vps.conf /etc/nginx/sites-available/messager
nginx -t ‚úÖ
nginx -s reload ‚úÖ
```

---

## üß™ –ü–†–û–í–ï–†–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–ê:

### 1. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
–û—Ç–∫—Ä–æ–π—Ç–µ: https://neekloai.ru

–ü—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏—Ç–µ **F5**

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ (F12)
**–î–æ–ª–∂–Ω—ã –∏—Å—á–µ–∑–Ω—É—Ç—å –æ—à–∏–±–∫–∏:**
- ‚ùå ~~502 Bad Gateway~~
- ‚úÖ API –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç (200 OK)
- ‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á—ë–Ω

### 3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:
- ‚úÖ –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
- ‚úÖ –°–æ–≤–µ—Ä—à–∏—Ç—å –≤–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∑–≤–æ–Ω–∫–∞ ("üìã –õ–æ–≥–∏")

---

## üìä –°–¢–ê–¢–£–° BACKEND:

```
PM2 –ø—Ä–æ—Ü–µ—Å—Å: messenger-api
PID: 79043
–°—Ç–∞—Ç—É—Å: online ‚úÖ
–ü–æ—Ä—Ç: 3001 ‚úÖ
Uptime: ~3 –º–∏–Ω—É—Ç—ã (–ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞)
Memory: 123.8 MB
```

---

## üéØ –¢–ï–ü–ï–†–¨ –ü–†–û–í–ï–†–¨–¢–ï TURN:

### –í –ª–æ–≥–∞—Ö –∑–≤–æ–Ω–∫–∞ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:

```
‚úÖ ICE servers: Custom TURN 89.169.39.244 (4 servers)
```

### –í –ª–æ–≥–∞—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
ssh root@89.169.39.244 "tail -f /var/log/turnserver/turnserver_2026-01-31.log"
```

**–ü–æ—è–≤—è—Ç—Å—è –∑–∞–ø–∏—Å–∏:**
```
session ...: new, realm=<neekloai.ru>, username=<turn_fdf8b6e8>
ALLOCATE processed, success
usage: rp=..., rb=...
```

---

## üéâ –í–°–Å –ò–°–ü–†–ê–í–õ–ï–ù–û!

### –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π TURN (89.169.39.244)
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (meta-—Ç–µ–≥–∏, nginx headers)
3. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–æ—Ä—Ç—ã –≤ Nginx (3001 –≤–º–µ—Å—Ç–æ 30000)
4. ‚úÖ Backend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
5. ‚úÖ Nginx –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω
6. ‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì:

### –û—Ç–∫—Ä–æ–π—Ç–µ https://neekloai.ru –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ:

1. ‚úÖ –ß–∞—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
2. ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
3. ‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á—ë–Ω
4. ‚úÖ –í–∏–¥–µ–æ–∑–≤–æ–Ω–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
5. ‚úÖ –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "Custom TURN 89.169.39.244"

**–°–æ–æ–±—â–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç!** üìû
