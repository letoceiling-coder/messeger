# ðŸš€ Ð‘Ð«Ð¡Ð¢Ð ÐžÐ• Ð ÐÐ—Ð’Ð•Ð Ð¢Ð«Ð’ÐÐÐ˜Ð• ÐÐ Ð¡Ð•Ð Ð’Ð•Ð Ð•

## âœ… ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ«

ÐÐ° ÑÐµÑ€Ð²ÐµÑ€Ðµ ÑƒÐ¶Ðµ ÐµÑÑ‚ÑŒ:
- âœ… Node.js v24.12.0
- âœ… npm 11.6.2
- âš ï¸ PM2 - Ð½ÑƒÐ¶Ð½Ð¾ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ
- âš ï¸ PostgreSQL - Ð½ÑƒÐ¶Ð½Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð°Ð½ÐµÐ»ÑŒ Beget

---

## ðŸ“‹ ÐŸÐžÐ¨ÐÐ“ÐžÐ’ÐÐ¯ Ð˜ÐÐ¡Ð¢Ð Ð£ÐšÐ¦Ð˜Ð¯

### Ð¨ÐÐ“ 1: ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÐµÑÑŒ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ

```bash
ssh dsc23ytp@5.101.156.207
```

---

### Ð¨ÐÐ“ 2: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Backend

```bash
cd ~/messager/backend

# 1. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ .env.production
cat > .env.production << 'EOF'
DATABASE_URL=postgresql://user:password@localhost:5432/messager
JWT_SECRET=your-secret-key-change-this-in-production-min-32-chars
REDIS_URL=redis://localhost:6379
PORT=3000
NODE_ENV=production
CORS_ORIGIN=https://parser-auto.siteaccess.ru
TELEGRAM_BOT_TOKEN=your-telegram-bot-token-optional
EOF

# Ð’ÐÐ–ÐÐž: ÐžÑ‚Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ DATABASE_URL!
# ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· Ð¿Ð°Ð½ÐµÐ»Ð¸ Beget:
# - Ð›Ð¾Ð³Ð¸Ð½ PostgreSQL
# - ÐŸÐ°Ñ€Ð¾Ð»ÑŒ PostgreSQL
# - Ð˜Ð¼Ñ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…
nano .env.production

# 2. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
npm install --production

# 3. Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Prisma Client
npx prisma generate

# 4. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ… (ÐµÑÐ»Ð¸ ÐµÑ‰Ðµ Ð½Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð°)
# Ð§ÐµÑ€ÐµÐ· Ð¿Ð°Ð½ÐµÐ»ÑŒ Beget Ð¸Ð»Ð¸:
# createdb messager

# 5. ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð‘Ð”
npx prisma migrate deploy

# 6. Ð¡Ð±Ð¾Ñ€ÐºÐ°
npm run build

# 7. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸
mkdir -p uploads/audio logs

# 8. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ PM2
npm install -g pm2

# 9. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

---

### Ð¨ÐÐ“ 3: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Frontend

```bash
cd ~/messager/frontend-web

# 1. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ .env.production
cat > .env.production << 'EOF'
VITE_API_URL=https://parser-auto.siteaccess.ru/api
VITE_WS_URL=wss://parser-auto.siteaccess.ru
EOF

# 2. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
npm install

# 3. Ð¡Ð±Ð¾Ñ€ÐºÐ°
npm run build

# 4. Ð Ð°Ð·Ð¼ÐµÑÑ‚Ð¸Ñ‚ÑŒ build Ð² public_html
cp -r dist/* ~/parser-auto.site-access.ru/public_html/
```

---

### Ð¨ÐÐ“ 4: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Nginx (ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾)

Ð•ÑÐ»Ð¸ Nginx ÐµÑ‰Ðµ Ð½Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½, ÑÐ¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ:

```bash
sudo nano /etc/nginx/sites-available/parser-auto
```

Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ:

```nginx
server {
    listen 80;
    server_name parser-auto.siteaccess.ru;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name parser-auto.siteaccess.ru;

    root /home/dsc23ytp/parser-auto.site-access.ru/public_html;
    index index.html;

    # SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ñ‹ (Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð°Ð½ÐµÐ»ÑŒ Beget)
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    # Frontend
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Backend API
    location /api {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # WebSocket
    location /socket.io/ {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
    }
}
```

ÐÐºÑ‚Ð¸Ð²Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ:

```bash
sudo ln -s /etc/nginx/sites-available/parser-auto /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

---

### Ð¨ÐÐ“ 5: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Backend
curl http://localhost:3000/health

# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ PM2
pm2 status
pm2 logs messager-backend

# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Frontend
# ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ: https://parser-auto.siteaccess.ru/
```

---

## âš ï¸ Ð’ÐÐ–ÐÐ«Ð• Ð—ÐÐœÐ•Ð§ÐÐÐ˜Ð¯

1. **PostgreSQL:**
   - ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð¸Ð· Ð¿Ð°Ð½ÐµÐ»Ð¸ Beget
   - Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð°Ð½ÐµÐ»ÑŒ Ð¸Ð»Ð¸ `createdb messager`
   - ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ `DATABASE_URL` Ð² `.env.production`

2. **JWT_SECRET:**
   - Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ 32 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°
   - Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½ÑƒÑŽ ÑÑ‚Ñ€Ð¾ÐºÑƒ
   - ÐÐµ Ñ…Ñ€Ð°Ð½Ð¸Ñ‚Ðµ Ð² Git!

3. **Redis:**
   - Ð•ÑÐ»Ð¸ Redis Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½, Ð¼Ð¾Ð¶Ð½Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ ÑƒÐ±Ñ€Ð°Ñ‚ÑŒ Ð¸Ð· ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
   - Ð˜Ð»Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð°Ð½ÐµÐ»ÑŒ Beget

4. **SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ñ‹:**
   - ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð°Ð½ÐµÐ»ÑŒ Beget
   - Ð˜Ð»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Let's Encrypt

---

## ðŸ› Ð Ð•Ð¨Ð•ÐÐ˜Ð• ÐŸÐ ÐžÐ‘Ð›Ð•Ðœ

### Backend Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ:
```bash
pm2 logs messager-backend
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ Ð½Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ¸
```

### Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð½Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ÑÑ:
```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ DATABASE_URL Ð² .env.production
# Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ Ð±Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÐ¾Ð·Ð´Ð°Ð½Ð°
```

### Frontend Ð½Ðµ Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ÑÑ:
```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ Ñ„Ð°Ð¹Ð»Ñ‹ ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ Ð² public_html
ls -la ~/parser-auto.site-access.ru/public_html/
```

---

## âœ… Ð“ÐžÐ¢ÐžÐ’Ðž!

ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð²ÑÐµÑ… ÑˆÐ°Ð³Ð¾Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½:
- Frontend: `https://parser-auto.siteaccess.ru/`
- Backend API: `https://parser-auto.siteaccess.ru/api`
