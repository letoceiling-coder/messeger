# üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–í–û–ù–ö–û–í - –ò–ù–°–¢–†–£–ö–¶–ò–Ø

## üéØ –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º

–°–µ–π—á–∞—Å –≤–∞—à –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π TURN —Å–µ—Ä–≤–µ—Ä** –≤–º–µ—Å—Ç–æ –æ–±–ª–∞—á–Ω–æ–≥–æ Metered.ca.
–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —Ä–∞–±–æ—Ç–∞—é—Ç –ª–∏ –≤–∏–¥–µ–æ/–∞—É–¥–∏–æ –∑–≤–æ–Ω–∫–∏.

---

## üì± –í–∞—Ä–∏–∞–Ω—Ç 1: –ë–´–°–¢–†–´–ô –¢–ï–°–¢ (–¢–µ–ª–µ—Ñ–æ–Ω ‚Üî –ü–ö)

**–≠—Ç–æ —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π —Ç–µ—Å—Ç!** –ü–æ—Ç–æ–º—É —á—Ç–æ —Ç–µ–ª–µ—Ñ–æ–Ω —á–µ—Ä–µ–∑ –º–æ–±–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –æ–±—ã—á–Ω–æ –Ω–µ –º–æ–∂–µ—Ç —Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é —Å –ü–ö (–Ω—É–∂–µ–Ω TURN).

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:
1. **–ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ:** –û—Ç–∫—Ä–æ–π—Ç–µ https://neekloai.ru (–∏–ª–∏ –≤–∞—à –¥–æ–º–µ–Ω)
   - –û—Ç–∫–ª—é—á–∏—Ç–µ Wi-Fi, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–±–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
   - –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Ññ1

2. **–ù–∞ –ü–ö:** –û—Ç–∫—Ä–æ–π—Ç–µ https://neekloai.ru
   - –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Ññ2
   - –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí –≤–∫–ª–∞–¥–∫–∞ Console

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
1. **–ò–Ω–∏—Ü–∏–∏—Ä—É–π—Ç–µ –≤–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫** —Å –ü–ö –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω (–∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç)
2. **–ü—Ä–∏–º–∏—Ç–µ –∑–≤–æ–Ω–æ–∫** –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
   - ‚úÖ –í–∏–¥–µ–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω
   - ‚úÖ –ó–≤—É–∫ —Å–ª—ã—à–µ–Ω —Å –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω
   - ‚úÖ –ù–µ—Ç –∑–∞–¥–µ—Ä–∂–µ–∫/–æ–±—Ä—ã–≤–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:
1. **–í–æ –≤—Ä–µ–º—è –∑–≤–æ–Ω–∫–∞** –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"üìã –õ–æ–≥–∏"**
2. **–ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É:** `ICE servers: Custom TURN 89.169.39.244`
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:** `iceConnectionState: connected`
4. **–°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç** –ª–æ–≥–æ–≤ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏:
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ** ‚Üí –ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –í–∞—à TURN –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚ö†Ô∏è **–†–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –µ—Å—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏** ‚Üí –ü–æ–∫–∞–∂–∏—Ç–µ –ª–æ–≥–∏, –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º
- ‚ùå **–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** ‚Üí –ü–æ–∫–∞–∂–∏—Ç–µ –ª–æ–≥–∏, –ø–µ—Ä–µ–∫–ª—é—á–∏–º –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ Metered.ca

---

## üíª –í–∞—Ä–∏–∞–Ω—Ç 2: –¢–ï–°–¢ –ù–ê –ü–ö (–î–≤–∞ –±—Ä–∞—É–∑–µ—Ä–∞)

–≠—Ç–æ—Ç —Ç–µ—Å—Ç –º–µ–Ω–µ–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π (–º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ STUN –±–µ–∑ TURN), –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–ª–µ–∑–µ–Ω.

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:
1. –û—Ç–∫—Ä–æ–π—Ç–µ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –≤ **–¥–≤—É—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö** (Chrome –∏ Firefox) –∏–ª–∏ –≤ **–¥–≤—É—Ö –æ–∫–Ω–∞—Ö** –æ–¥–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞
2. –í–æ–π–¥–∏—Ç–µ –ø–æ–¥ —Ä–∞–∑–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
1. –°–æ–≤–µ—Ä—à–∏—Ç–µ –≤–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∏–¥–µ–æ –∏ –∑–≤—É–∫
3. –û—Ç–∫—Ä–æ–π—Ç–µ –ª–æ–≥–∏ (üìã) –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ TURN

---

## üåê –í–∞—Ä–∏–∞–Ω—Ç 3: –¢–ï–°–¢ –ß–ï–†–ï–ó NAT/Firewall

–°–∞–º—ã–π —Å—Ç—Ä–æ–≥–∏–π —Ç–µ—Å—Ç - –µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–¥–µ—Å—å, –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤–µ–∑–¥–µ.

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:
1. –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –∏–∑ –æ—Ñ–∏—Å–Ω–æ–π —Å–µ—Ç–∏ —Å —Ñ–∞–π—Ä–≤–æ–ª–æ–º
2. –î—Ä—É–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –∏–∑ –¥–æ–º–∞ —á–µ—Ä–µ–∑ –¥–æ–º–∞—à–Ω–∏–π —Ä–æ—É—Ç–µ—Ä
3. –ò–ª–∏ –æ–±–∞ —á–µ—Ä–µ–∑ –º–æ–±–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Ä–∞–∑–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
1. –°–æ–≤–µ—Ä—à–∏—Ç–µ –∑–≤–æ–Ω–æ–∫
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

---

## üìä –ö—É–¥–∞ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ –ª–æ–≥–∞—Ö

### ‚úÖ –•–û–†–û–®–ò–ï –ø—Ä–∏–∑–Ω–∞–∫–∏:
```
ICE servers: Custom TURN 89.169.39.244 (4 servers)
ICE gathering (caller): gathering
ICE gathering (caller): complete
iceConnectionState (caller): checking
iceConnectionState (caller): connected
connectionState: connected ice: connected
ontrack (caller): audio streams=1
ontrack (caller): video streams=1
```

### ‚ùå –ü–õ–û–•–ò–ï –ø—Ä–∏–∑–Ω–∞–∫–∏:
```
ICE servers: Google STUN (fallback)  ‚Üê TURN –Ω–µ –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è!
iceConnectionState: failed  ‚Üê –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
Connection failed  ‚Üê –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```

---

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@89.169.39.244

# –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ TURN –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f /var/log/turnserver/turnserver.log

# –í–æ –≤—Ä–µ–º—è –∑–≤–æ–Ω–∫–∞ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å–∏:
# session ...: new, user <turn_fdf8b6e8>
# session ...: allocation created
```

### –í –±—Ä–∞—É–∑–µ—Ä–µ (DevTools ‚Üí Console):
```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
console.log(import.meta.env.VITE_TURN_USER);
console.log(import.meta.env.VITE_TURN_SERVER);
```

---

## üîÑ –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –±—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç

```bash
ssh root@89.169.39.244

# –í–µ—Ä–Ω—É—Ç—å –æ–±–ª–∞—á–Ω—ã–π TURN (Metered.ca)
cp /var/www/messager/frontend-web/.env.production.metered.backup /var/www/messager/frontend-web/.env.production

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å
cd /var/www/messager/frontend-web
npm run build

# –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
```

---

## üìù –û—Ç—á—ë—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤ –Ω–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ:

1. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–±–æ—Ç–∞–µ—Ç / –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç / –†–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏
2. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** –¢–µ–ª–µ—Ñ–æ–Ω ‚Üî –ü–ö / –ü–ö ‚Üî –ü–ö / –î—Ä—É–≥–æ–µ
3. **–ß—Ç–æ –≤ –ª–æ–≥–∞—Ö:** –°–∫—Ä–∏–Ω—à–æ—Ç –∏–ª–∏ —Ç–µ–∫—Å—Ç –ª–æ–≥–æ–≤
4. **–ü—Ä–æ–±–ª–µ–º—ã:** –û–ø–∏—Å–∞–Ω–∏–µ —á—Ç–æ –Ω–µ —Ç–∞–∫

–Ø –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É—é –∏:
- –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –∏—Å–ø—Ä–∞–≤–ª—é –∏–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á—É –Ω–∞ Metered.ca
- –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏ ‚Üí –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é
- –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ ‚Üí –ø–æ–∑–¥—Ä–∞–≤–ª—é –∏ –∑–∞–∫—Ä–æ–µ–º –∑–∞–¥–∞—á—É! üéâ

---

## üöÄ –ù–ê–ß–ò–ù–ê–ô–¢–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï!

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://neekloai.ru –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ (–º–æ–±–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç!)
2. –û—Ç–∫—Ä–æ–π—Ç–µ https://neekloai.ru –Ω–∞ –ü–ö
3. –°–æ–≤–µ—Ä—à–∏—Ç–µ –≤–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ (üìã)
5. –°–æ–æ–±—â–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç!

**–£–¥–∞—á–∏! üçÄ**
