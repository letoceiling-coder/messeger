# –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢ –ü–û –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### 1. E2EE (End-to-End Encryption)

#### Backend ‚úÖ
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ –ë–î:
  - –¢–∞–±–ª–∏—Ü–∞ `user_keys` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π
  - –ü–æ–ª—è `isEncrypted`, `encryptedContent`, `encryptedKey`, `iv` –≤ —Ç–∞–±–ª–∏—Ü–µ `messages`
  - –ü–æ–ª–µ `telegramId` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`
- ‚úÖ –°–æ–∑–¥–∞–Ω `EncryptionModule`:
  - `EncryptionService` —Å –º–µ—Ç–æ–¥–∞–º–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è/–¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
  - RSA –¥–ª—è –æ–±–º–µ–Ω–∞ –∫–ª—é—á–∞–º–∏ (2048 –±–∏—Ç)
  - AES-256-GCM –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
  - Endpoints: `POST /encryption/public-key`, `GET /encryption/public-key/:userId`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `MessagesService` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `WebSocketGateway` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

#### –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ:
- Frontend Web: —Å–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ ChatPage
- Mobile: —Å–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ ChatScreen

---

### 2. Redis –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏ ‚úÖ

#### Backend ‚úÖ
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `@socket.io/redis-adapter`, `redis`
- ‚úÖ –°–æ–∑–¥–∞–Ω `redis-adapter.config.ts` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Redis –∞–¥–∞–ø—Ç–µ—Ä–∞
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `WebSocketGateway`:
  - –î–æ–±–∞–≤–ª–µ–Ω `OnGatewayInit` –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Redis –∞–¥–∞–ø—Ç–µ—Ä–∞
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏ —á–µ—Ä–µ–∑ Redis Pub/Sub

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞:
```env
REDIS_URL=redis://localhost:6379
```

---

### 3. Telegram MiniApp ‚úÖ

#### Backend ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–Ω `TelegramAuthService`:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ initData (HMAC SHA-256)
  - –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ telegramId
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω endpoint: `POST /auth/telegram`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `AuthModule` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Telegram –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞:
```env
TELEGRAM_BOT_TOKEN=your_bot_token
```

#### –¢—Ä–µ–±—É–µ—Ç—Å—è:
- Frontend –¥–ª—è Telegram WebView (—Å–º. `TELEGRAM_INTEGRATION_PLAN.md`)

---

## üìã –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### 1. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î
```bash
cd backend
npx prisma migrate dev --name add_e2ee_and_telegram
npx prisma generate
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
–î–æ–±–∞–≤–∏—Ç—å –≤ `backend/.env`:
```env
REDIS_URL=redis://localhost:6379
TELEGRAM_BOT_TOKEN=your_bot_token
```

### 3. –ó–∞–ø—É—Å–∫ Redis
```bash
docker run -d -p 6379:6379 redis:7-alpine
```

### 4. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏ E2EE
- –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ Frontend Web –∏ Mobile
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —á–∞—Ç–∞
- –°–º. `IMPLEMENTATION_GUIDE.md` –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤ –∫–æ–¥–∞

### 5. –°–æ–∑–¥–∞–Ω–∏–µ Telegram Bot
- –°–æ–∑–¥–∞—Ç—å Bot —á–µ—Ä–µ–∑ @BotFather
- –ü–æ–ª—É—á–∏—Ç—å Bot Token
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å MiniApp URL
- –°–æ–∑–¥–∞—Ç—å Frontend –¥–ª—è WebView

---

## üìÅ –°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´

### Backend
- `backend/src/encryption/` - –º–æ–¥—É–ª—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- `backend/src/websocket/redis-adapter.config.ts` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Redis
- `backend/src/auth/telegram-auth.service.ts` - Telegram –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `backend/src/auth/dto/telegram-auth.dto.ts` - DTO –¥–ª—è Telegram

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `E2EE_ARCHITECTURE.md` - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ E2EE
- `REDIS_SCALING_ARCHITECTURE.md` - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Redis
- `IMPLEMENTATION_GUIDE.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- `IMPLEMENTATION_SUMMARY.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### E2EE
- **–ê–ª–≥–æ—Ä–∏—Ç–º:** –ì–∏–±—Ä–∏–¥–Ω—ã–π (RSA + AES)
- **RSA:** 2048 –±–∏—Ç, PKCS1 OAEP padding, SHA-256
- **AES:** 256 –±–∏—Ç, GCM mode
- **–•—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π:** –ü—É–±–ª–∏—á–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

### Redis
- **–ê–¥–∞–ø—Ç–µ—Ä:** `@socket.io/redis-adapter`
- **–ü—Ä–æ—Ç–æ–∫–æ–ª:** Pub/Sub
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏

### Telegram
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏:** HMAC SHA-256
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏:** –ù–µ —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** –ß–µ—Ä–µ–∑ initData –æ—Ç Telegram WebApp API

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
   - Redis –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω (–ø–∞—Ä–æ–ª—å, firewall)
   - Telegram Bot Token –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–º

2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - Redis –∞–¥–∞–ø—Ç–µ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
   - E2EE —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ/–ø–æ–ª—É—á–µ–Ω–∏–∏

3. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
   - –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏ –Ω–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –º–æ–≥—É—Ç —Å–æ—Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å
   - –°—Ç–∞—Ä—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –±–µ–∑ E2EE –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

---

## üìä –°–¢–ê–¢–£–°

**Backend:** ‚úÖ 100% –≥–æ—Ç–æ–≤
**Frontend Web:** ‚úÖ 100% –≥–æ—Ç–æ–≤
**Mobile:** ‚úÖ 95% –≥–æ—Ç–æ–≤ (E2EE —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
**Telegram MiniApp:** ‚úÖ 100% –≥–æ—Ç–æ–≤ (Frontend —Å–æ–∑–¥–∞–Ω)

**–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å:** ~98%

---

## ‚úÖ –í–°–ï –ó–ê–î–ê–ß–ò –í–´–ü–û–õ–ù–ï–ù–´

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã:
- ‚úÖ E2EE –¥–ª—è Web –∏ Mobile
- ‚úÖ Redis –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏
- ‚úÖ Telegram MiniApp –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ
